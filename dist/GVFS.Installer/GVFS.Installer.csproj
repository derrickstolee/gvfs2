<Project Sdk="Microsoft.Build.NoTargets">

  <PropertyGroup>
    <TargetFramework>net461</TargetFramework>
    <LayoutPath>$(RepoOutPath)dist\GVFS.Payload\bin\$(Configuration)\</LayoutPath>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Tools.InnoSetup" Version="5.5.9" ExcludeAssets="all" GeneratePathProperty="true" />
    <PackageReference Include="MicroBuild.Core" Version="0.2.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\GVFS.Payload\GVFS.Payload.csproj" Private="false" />
  </ItemGroup>

  <ItemGroup>
    <None Include="Setup.iss" />
  </ItemGroup>

  <ItemGroup>
    <FilesToSign Include="$(OutputPath)SetupGVFS.$(GVFSVersion).exe">
      <Authenticode>Microsoft400</Authenticode>
      <InProject>false</InProject>
    </FilesToSign>
  </ItemGroup>

  <Target Name="CreateInstaller" BeforeTargets="Build;SignFiles">
    <Exec Command="$(PkgTools_InnoSetup)\tools\ISCC.exe /DLayoutDir=$(LayoutPath) /DGVFSVersion=$(GVFSVersion) Setup.iss /O$(OutputPath)" />
  </Target>

  <Target Name="CleanInstaller" BeforeTargets="AfterClean">
    <ItemGroup>
      <FilesToDelete Include="$(OutputPath)SetupGVFS.$(GVFSVersion).exe"/>
    </ItemGroup>
    <Delete Files="@(FilesToDelete)" />
  </Target>

</Project>
